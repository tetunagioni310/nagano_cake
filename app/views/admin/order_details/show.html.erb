<h1>注文履歴詳細</h1>

<table style="background-color: green;">
    <tr>
      <table style="background-color: red;">
      <tr>
        <td><strong>購入者</strong></td>
        <td><%= @customer.full_name %></td>
      </tr>
      
      <tr>
        <td><strong>注文日</strong></td>
        <td><%= @order.created_at.strftime('%Y/%m/%d') %></td>
      </tr>

      <tr>
        <td><strong>配送先</strong></td>
        <td><%= @order.full_address %></td>
      </tr>

      <tr>
        <td><strong>支払方法</strong></td>
        <td><%= @order.payment_method_i18n %></td>
      </tr>

      <tr>
        <td><strong>注文ステータス</strong></td>
        <td>
          <%= form_with model: @order, url: admin_order_path(@order.id), method: :patch do |f| %>
          <%= f.select :status, Order.statuses.keys.map {|k| [I18n.t("enums.order.status.#{k}"), k]} %>
          <%= f.submit "更新" %>
          <% end %>
        </td>
      </tr>
    </table>
    </tr>
  <br>
    <tr>
      <td>
        <table style="background-color: blue;">
        <tr>
          <td><strong>商品名</strong></td>
          <td><strong>単価（税込）</strong></td>
          <td><strong>数量</strong></td>
          <td><strong>小計</strong></td>
          <td><strong>制作ステータス</strong></td>
        </tr>

        <% @order_details.each do |order_detail| %>
        <tr>
          <td><%= order_detail.item.name  %></td>
          <td><%= order_detail.purchase_price.to_s(:delimited) %></td>
          <td><%= order_detail.amount %></td>
          <td>
            <% @item_total = (order_detail.purchase_price * order_detail.amount) %>
            <%= @item_total.to_s(:delimited)%>
            <% @total_price += @item_total %>
          </td>
          <td>
            <%= form_with model: order_detail, url: admin_order_detail_path(order_detail.id), method: :patch do |f| %>
              <%= f.select :make_status, OrderDetail.make_statuses.keys.map {|k| [I18n.t("enums.order_detail.make_status.#{k}"), k]} %>
              <%= f.submit "更新" %>
            <% end %>
          </td>
        </tr>
        <% end %>
       </table>
      </td>
      
      <td>
        <table style="background-color: yellow;">
          <tr>
            <td><strong>商品合計</strong></td>
            <td><%= @total_price %></td>
          </tr>
  
          <tr>
            <td><strong>送料</strong></td>
            <td><%= @order.shipping_cost %></td>
          </tr>
          <tr>
            <td><strong>請求金額</strong></td>
            <td><%= @order.bill %></td>
          </tr>
      </table>
      </td>
    </tr>
</table>


